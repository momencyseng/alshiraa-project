{% extends "base.html" %}

{% block content %}
<section class="section">
    <div class="container">
        <div
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
            <h1 class="heading-md">
                <span class="lang-en">Dashboard</span>
                <span class="lang-ar">لوحة التحكم</span>
            </h1>
            <div style="display: flex; gap: 10px;">
                {% if current_user.role == 'admin' %}
                <a href="{{ url_for('manage_staff') }}" class="btn secondary-btn"
                    style="border-color: var(--primary-color); color: var(--primary-color);">
                    <i class="fas fa-users-cog"></i> <span class="lang-en">Staff</span><span
                        class="lang-ar">الموظفين</span>
                </a>
                {% endif %}
                <a href="{{ url_for('manage_blog') }}" class="btn secondary-btn"
                    style="border-color: var(--primary-color); color: var(--primary-color);">
                    <i class="fas fa-blog"></i> <span class="lang-en">Blog</span><span class="lang-ar">المدونة</span>
                </a>
                <a href="{{ url_for('add_product') }}" class="btn">
                    <i class="fas fa-plus"></i>
                    <span class="lang-en">Add Product</span>
                    <span class="lang-ar">إضافة منتج</span>
                </a>
            </div>
        </div>

        <div style="background: var(--light-bg); padding: 1.5rem; border-radius: 8px;">
            <h2 class="text-center heading-md">
                <span class="lang-en">Product Management</span>
                <span class="lang-ar">إدارة المنتجات</span>
            </h2>

            <div class="services-grid" style="grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));">
                {% for product in products %}
                <div class="service-card" style="position: relative; text-align: left; padding: 1rem;">
                    {% if product.image_filename %}
                    <img src="{{ url_for('static', filename='uploads/' + product.image_filename) }}"
                        alt="{{ product.name }}"
                        style="width: 100%; height: 200px; object-fit: cover; border-radius: 4px; margin-bottom: 1rem;">
                    {% else %}
                    <div
                        style="width: 100%; height: 200px; background: #ddd; display: flex; align-items: center; justify-content: center; border-radius: 4px; margin-bottom: 1rem;">
                        <i class="fas fa-image" style="font-size: 3rem; color: #999;"></i>
                    </div>
                    {% endif %}

                    <h3 style="color: var(--primary-color);">{{ product.name }}</h3>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 0.5rem;">
                        <span class="badge"
                            style="background: var(--accent-color); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem;">
                            {% if product.category == 'solar' %}Solar Energy{% elif product.category == 'security'
                            %}Security{% else %}Inverters{% endif %}
                        </span>
                    </p>
                    <p style="margin-bottom: 1rem; height: 60px; overflow: hidden; text-overflow: ellipsis;">{{
                        product.description[:100] }}...</p>

                    <div style="display: flex; gap: 0.5rem;">
                        <a href="{{ url_for('edit_product', product_id=product.id) }}" class="btn secondary-btn"
                            style="flex: 1; text-align: center; border-color: var(--primary-color); color: var(--primary-color);">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        <!-- Add confirmation for delete -->
                        <a href="{{ url_for('delete_product', product_id=product.id) }}" class="btn"
                            style="background: #dc3545; flex: 1; text-align: center;"
                            onclick="return confirm('Are you sure you want to delete this product?');">
                            <i class="fas fa-trash"></i> Delete
                        </a>
                    </div>
                </div>
                {% else %}
                <div style="grid-column: 1 / -1; text-align: center; padding: 2rem;">
                    <p>No products found. Add your first product!</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endblock %}